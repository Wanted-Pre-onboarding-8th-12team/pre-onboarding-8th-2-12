# ë™ë£Œí•™ìŠµì„ í†µí•´ì„œ ì¸í„´ì‰½ ì„ ë°œ ê³¼ì œ Best Practice ë§Œë“¤ê¸°

## ğŸ“• ê°œìš”

ë°°í¬ ë§í¬

### ê³¼ì œ ëª©í‘œ

> ì´ìŠˆ íŠ¸ë˜í‚¹ ê¸°ëŠ¥ êµ¬í˜„(e.g, Jira, Trello)

### ê¸°ê°„

2023.01.03 ~ 2023.01.06

---

## ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Members

|                                              ë¥˜ì§€ì°½                                              |                                             ë°•ì¤€í•˜                                              |                                             ë°±ê´‘ì²œ                                              |                                             ìœ ì œì›                                              |                                             ì •ì„¸ì—°                                              |                                             ì¡°ì˜ì¼                                              |
| :----------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------: |
| <img src="https://avatars.githubusercontent.com/u/104156381?s=70&v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/85827017?s=70&v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/82658528?s=70&v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/96014828?s=70&v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/79056677?s=70&v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/86599495?s=70&v=4" width="100" height="100"/> |
|                           [RyuJiChang](https://github.com/RyuJiChang)                            |                            [harseille](https://github.com/harseille)                            |                             [back0202](https://github.com/back0202)                             |                               [LLSJYY](https://github.com/LLSJYY)                               |                               [n0eyes](https://github.com/n0eyes)                               |                            [young1the](https://github.com/young1the)                            |

---

## ğŸ–¥ Demo

ì‹œì—°ì˜ìƒ

---

## âš¡ï¸ ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬

- react: 18.2.0
- react-dom: 18.2.0
- styled-components: 5.3.6
- react-query: 4.20.4
- axios: 1.2.2
- msw: 0.49.2

---

## âœ… ìš”êµ¬ ì‚¬í•­ ì²´í¬ë¦¬ìŠ¤íŠ¸

1. êµ¬í˜„ ì‚¬í•­

- [x] ê° ì´ìŠˆëŠ” CRUD(ìƒì„±, í‘œì¶œ, ìˆ˜ì •, ì‚­ì œ)ê°€ ì ìš©ë˜ì–´ì•¼ í•œë‹¤.
- [x] ì´ìŠˆëŠ” ê°ê° **ê³ ìœ ë²ˆí˜¸, ì œëª©, ë‚´ìš©, ë§ˆê°ì¼, ìƒíƒœ, ë‹´ë‹¹ì**ê°€ ì¡´ì¬í•œë‹¤.
- [x] ì´ìŠˆì˜ ìƒíƒœëŠ” **â€œí•  ì¼â€, â€œì§„í–‰ ì¤‘â€, ì™„ë£Œâ€**ê°€ ì¡´ì¬í•˜ë©° ì¹¸ë°˜ë³´ë“œì™€ ê°™ì´ ìƒíƒœë³„ë¡œ ë¶„ë¥˜ëœë‹¤
- [x] ì´ìŠˆì˜ ì‘ì„± í¼ì—ì„œëŠ” **ì œëª©, ë‚´ìš©, ë§ˆê°ì¼, ìƒíƒœ, ë‹´ë‹¹ì**ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆë‹¤.
  - [x] ì œëª©ì€ `<input type=â€textâ€>` íƒœê·¸ë¥¼ ì‚¬ìš©í•œë‹¤.
  - [x] ë‚´ìš©ì€ `<textarea>` íƒœê·¸ë¥¼ ì‚¬ìš©í•œë‹¤.
  - [x] ë§ˆê°ì¼ì€ `<input type=â€datetime-localâ€>` íƒœê·¸ë¥¼ ì‚¬ìš©í•œë‹¤.
  - [x] ë‹´ë‹¹ì ì„ íƒì€ ì•„ë˜ì˜ ë°©ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤.
    - [x] ì‚¬ì „ì— ì„ì˜ì˜ ë‹´ë‹¹ì ëª©ë¡ì„ êµ¬ì„±í•œë‹¤.
    - [x] `<input type=â€textâ€>` íƒœê·¸ë¥¼ ì´ìš©í•´ ë‹´ë‹¹ìë¥¼ ê²€ìƒ‰í•œë‹¤.
    - [x] ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ë©´ ê²€ìƒ‰ê²°ê³¼ ê°’ì´ ë…¸ì¶œë˜ë©° ê·¸ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì„œ ë‹´ë‹¹ìë¥¼ ì§€ì •í•œë‹¤.
- [x] ê° ì´ìŠˆë¥¼ í´ë¦­ ì‹œ ìƒì„¸ì •ë³´ ì°½ì´ í‘œì‹œëœë‹¤.
  - [x] ìƒì„¸ì •ë³´ ì°½ì—ëŠ” **â€œì €ì¥â€**ë²„íŠ¼ì´ ì¡´ì¬í•œë‹¤.
  - [x] ìƒì„¸ì •ë³´ì°½ì—ì„œëŠ” ì´ìŠˆì˜ ê° ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìœ¼ë©°, **â€œì €ì¥â€**ë²„íŠ¼ì„ í´ë¦­ ì‹œ ìˆ˜ì •í•œ ë‚´ìš©ì´ ë°˜ì˜ëœë‹¤.
- [x] ì´ìŠˆ ìƒíƒœë³„ ëª©ë¡ì€ ê¸°ë³¸ì ìœ¼ë¡œ ê³ ìœ ë²ˆí˜¸ ìˆœì„œëŒ€ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•œë‹¤.
- [x] ì´ìŠˆ ëª©ë¡ì—ì„œ ë§ˆìš°ìŠ¤ì˜ Drag & Drop ì´ë²¤íŠ¸ë¥¼ í™œìš©í•´ ì´ìŠˆì˜ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ë³€ê²½ëœ ìˆœì„œëŠ” ê³ ìœ ë²ˆí˜¸ìˆœ ì •ë ¬ë³´ë‹¤ ìš°ì„ í•´ì„œ ì ìš©ëœë‹¤.
- [x] ì´ìŠˆ ëª©ë¡ì—ì„œ ë§ˆìš°ìŠ¤ì˜ Drag & Drop ì´ë²¤íŠ¸ë¥¼ í™œìš©í•´ ì´ìŠˆì˜ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

2. êµ¬í˜„ ì¡°ê±´

- [x] ë°ì´í„°ê°€ ë¡œë”©ì¤‘ì¸ ê²½ìš° ì‚¬ìš©ìê°€ ì´ë¥¼ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ UXë¥¼ ê³ ë ¤í•´ì•¼ í•˜ë©°, ë¡œë”© ì¤‘ì—ëŠ” ì•¡ì…˜ì´ ë°œìƒí•˜ëŠ” ê²ƒì„ ë°©ì§€í•´ì•¼í•œë‹¤.
- [ ] ê° ê¸°ëŠ¥ë“¤ì€ ì‹¤ìˆ˜ë¡œ ì¸í•œ ì¤‘ë³µ ì•¡ì…˜ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‹¤í–‰ í›„ 0.5ì´ˆì˜ ë”œë ˆì´ë¥¼ ì ìš©í•œë‹¤.
- [x] ë°ì´í„°ëŠ” ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë  ìˆ˜ ìˆë„ë¡ ê´€ë¦¬í•œë‹¤.

## ğŸ‘ Best Practice

### 1. ë°ì´í„° ìœ ì§€

APIê°€ ì œê³µë˜ì§€ ì•Šì€ ê³¼ì œì´ë‚˜ ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ë„ ìœ ì§€ë  ìˆ˜ ìˆë„ë¡ í•´ì•¼í–ˆë‹¤.
`MSW(Mock Service Worker)`ë¥¼ ì´ìš©í•´ì„œ ê°„ì´ ì„œë²„ë¥¼ êµ¬ì„±í•˜ê³  ë°ì´í„°ë¥¼ ê´€ë¦¬í–ˆë‹¤.

```js
// src/mocks/handlers.js
// ...
export const handlers = [
  rest.get('/board', (req, res, ctx) => {
    const data = getData();

    return res(ctx.status(200), ctx.json(data));
  }),
];
```

<!-- #### ë‹¤ë¥¸ case

- localStorageë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ëŠ” ë°©ë²•

**ë¹„ì„ ì • ì´ìœ **
- ë°ì´í„°ê°€ ëŠ˜ì–´ë‚  ìˆ˜ë¡ ì‚¬ìš©ì í™˜ê²½ì—ì„œ ë¶€ë‹´í•´ì•¼í•˜ëŠ” ë°ì´í„°ì˜ í¬ê¸°ê°€ ì»¤ì§„ë‹¤.
- ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë°ì´í„° ì¶”ì ì´ ì–´ë µë‹¤ -->

### 2. ì´ìŠˆ ëª©ë¡ ìˆœì„œ ì ìš© ë°©ë²•

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ë©´, í•´ë‹¹ issueë¥¼ state(â€todoâ€,â€pending,â€fullfiedâ€)ë¡œ ë‚˜ë‰˜ì–´ì„œ ê°ê° state ë³„ë¡œ ë°°ì—´ë¡œ ë§Œë“¤ê³  í•´ë‹¹ `ë°°ì—´ì„ orderì— ë”°ë¼ sort` í•´ì¤€ë‹¤.

```js
const getData = () => {
  const boardTable = getBoardTable();
  return {
    title: boardTable.title,
    owners: boardTable.owners,
    states: boardTable.states.map((state) => {
      const issues = boardTable.issues
        .filter((issue) => issue.state === state.id)
        .sort((a, b) => a.order - b.order);

      return { ...state, issues };
    }),
  };
```

issueì˜ ì´ˆê¸° orderê°’ì€ 1024ë¡œ ì§€ì •í•œë‹¤.

- ë°°ì—´ì— ìƒˆë¡œìš´ issueê°€ **ê°€ì¥ ë’¤**ì— ì¶”ê°€ë  ë•Œ
  orderì— 1024ë¥¼ ë”í•´ì¤€ë‹¤.

```js
[1024, 2048, 4096, â€¦];
```

- ë°°ì—´ì— ìƒˆë¡œìš´ issueê°€ **ê°€ì¥ ì•**ì— ì¶”ê°€ë  ë•Œ
  orderë¥¼ 2ë¡œ ë‚˜ëˆ„ì–´ì¤€ë‹¤.

```js
[ â€¦, 128, 256, 512, 1024];
```

- ë°°ì—´ì— ìƒˆë¡œìš´ isserê°€ **ì¤‘ê°„**ì— ì¶”ê°€ë  ë•Œ
  ì•ì˜ ë°°ì—´ì˜ orderì™€ ë’¤ì˜ ë°°ì—´ì˜ orderë¥¼ ë”í•´ì£¼ê³  2ë¡œ ë‚˜ëˆˆë‹¤.

```js
[1024, newItem ,2048] â‡’ newItem = 1536
```

```js
const updateDnD = (body) => {
  const { position, targetId, draggingId } = body;

  const db = getDB();
  const data = getData();
  const [draggingIssue] = db.issues.filter((issue) => issue.id === draggingId);
  const [targetIssue] = db.issues.filter((issue) => issue.id === targetId);
  const targetStateId = targetIssue.state;
  const [targetState] = data.states.filter(
    (state) => state.id === targetStateId
  );
  const issues = targetState.issues;

  const targetIssueIdx = issues.findIndex((issue) => issue.id === targetId);

  if (position === 'before') {
    if (targetIssueIdx === 0) {
      draggingIssue.order = targetIssue.order / 2;
    } else {
      draggingIssue.order =
        (issues[targetIssueIdx].order + issues[targetIssueIdx - 1].order) / 2;
    }
  }

  if (position === 'after') {
    if (targetIssueIdx === issues.length - 1) {
      draggingIssue.order = targetIssue.order + 1024;
    } else {
      draggingIssue.order =
        (issues[targetIssueIdx].order + issues[targetIssueIdx + 1].order) / 2;
    }
  }

  draggingIssue.state = targetStateId;

  const newIssues = db.issues
    .map((issue) => (issue.id === draggingId ? draggingIssue : issue))
    .sort((a, b) => a.id - b.id);

  db.issues = newIssues;

  localStorage.setItem('boardTable', JSON.stringify(db));
};
```

[ì°¸ê³ ë¬¸í—Œ](https://blog.hyositive.com/m/55)

### 3. Drag & Drop êµ¬í˜„

`useDnD` ë¼ëŠ” custom hookì„ ì‘ì„±í•´ì„œ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í–ˆë‹¤.

```jsx
export const useDnD = () => {
  let draggingId = null;
  const [positionInfo, setPositionInfo] = useState({
    position: '',
    targetId: null,
  });

  const handleDragStart = (e) => {
    draggingId = Number(e.target.dataset.id);

    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('draggingId', draggingId);
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    const newPositionInfo = getPositionInfo(e.target, e.clientY);

    if (
      positionInfo.position !== newPositionInfo.position &&
      draggingId !== newPositionInfo.targetId
    ) {
      setPositionInfo((prev) => ({ ...prev, ...newPositionInfo }));
    }
  };

  const handleDrop = (e) => {
    const draggingId = JSON.parse(e.dataTransfer.getData('draggingId'));
  };

  return { handleDragStart, handleDragOver, handleDrop, positionInfo };
};
```

draggable í•œ ì»´í¬ë„ŒíŠ¸ì—ì„œ `onDragStart`, `onDragOver`ë“± ë°˜í™˜ ë°›ì€ ë©”ì„œë“œë¥¼ ì´ë²¤íŠ¸í•¸ë“¤ëŸ¬ë¥¼ ì‚¬ìš©í•œë‹¤.

```jsx
export const Card = ({ issue, DnD, onClick: deleteIssue }) => {
  const { title, id } = issue;

  const {
    positionInfo: { position, targetId },
    handleDragStart,
    handleDragOver,
    handleDragLeave,
    handleDrop,
  } = DnD;

  return (
    <Styled.Root
      draggable
      onDragOver={handleDragOver}
      onDragStart={handleDragStart}
      onDragLeave={handleDragLeave}
      onDrop={handleDrop}
      data-id={id}
      hover
      {...(targetId === id ? { position } : null)}
    >
      <Styled.Title>{title}</Styled.Title>
      <Styled.DeleteBtn onClick={() => deleteIssue(id)}>ì‚­ì œ</Styled.DeleteBtn>
      {/* <Modal></Modal> */}
    </Styled.Root>
  );
};
```

dragê°€ ëë‚¬ì„ ë•Œ react-queryì˜ mutationì„ ì´ìš©í•´ `'/board/dndâ€™ ê²½ë¡œì— put ìš”ì²­`ì„ ë³´ë‚´ì„œ ì„œë²„ì˜ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê³  listë¥¼ ë‹¤ì‹œ ë°›ì•„ì˜¨ë‹¤.

```js
  rest.put('/board/dnd', (req, res, ctx) => {
    updateDnD(req.body);

    const data = getData();

    return res(ctx.status(200), ctx.json(data));
  }),
```

### 4. ë°ì´í„° ë¡œë”© ì¤‘ì¼ ë•Œ fallback ë§Œë“¤ê¸°

reactì˜ Suspense ì»´í¬ë„ŒíŠ¸ë¥¼ ì´ìš©í•´ì„œ ë¡œë”©ì— ëŒ€í•œ fallbackì„ êµ¬í˜„í–ˆë‹¤.
ìµœìƒë‹¨ ì»´í¬ë„ŒíŠ¸ì— ì ìš©í–ˆë‹¤.

```jsx
// src/App.jsx
<Layout onClick={clickHandler}>
  <Suspense fallback={<div>loading...</div>}>
    <Board />
  </Suspense>
</Layout>
```

### 5. ë¶ˆí•„ìš”í•œ ë Œë”ë¦° ë°©ì§€

- ì œìë¦¬ DnD ë°©ì§€

```js
const handleDrop = (e) => {
  const draggingId = e.dataTransfer.getData('draggingId');

  /**
   * ì œìë¦¬ DnD ë°©ì§€ë¥¼ ìœ„í•´ targetId ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤
   * ë®¤í…Œì´ì…˜ í›„ ì´ˆê¸°í™”
   */
  if (positionInfo.targetId && draggingId !== positionInfo.targetId) {
    updateDnD(
      { ...positionInfo, draggingId },
      {
        onSettled() {
          setPositionInfo(initialInfo);
        },
      }
    );
  }
};
```

## ğŸ“ ë¬¸ì„œ

[íšŒì˜ë¡](https://absorbed-leek-405.notion.site/2-best-practice-9d77b76380b14b8d9357e07dd8e80e17)
